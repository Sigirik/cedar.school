# Cedar.school ‚Äî Project Context

## üéØ –¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞
Cedar.school ‚Äî —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –æ–Ω–ª–∞–π–Ω-—à–∫–æ–ª—ã, –∫–æ—Ç–æ—Ä–∞—è —É–ø—Ä–∞–≤–ª—è–µ—Ç:
- —à–∞–±–ª–æ–Ω–Ω—ã–º–∏ –Ω–µ–¥–µ–ª—è–º–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è (TemplateWeek),
- —Ä–µ–∞–ª—å–Ω—ã–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º (RealLesson),
- –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω–æ-—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º (–ö–¢–ü),
- —Ä–æ–ª—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—É—á–∏—Ç–µ–ª—å, —É—á–µ–Ω–∏–∫, —Ä–æ–¥–∏—Ç–µ–ª—å, –∑–∞–≤—É—á, –¥–∏—Ä–µ–∫—Ç–æ—Ä),
- –≤–∏–¥–µ–æ–∑–∞–Ω—è—Ç–∏—è–º–∏ (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Jitsi/BBB),
- –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–º–∏ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞–º–∏ (–∫–ª–∞—Å—Å—ã, –ø—Ä–µ–¥–º–µ—Ç—ã, –≥–æ–¥—ã, —á–µ—Ç–≤–µ—Ä—Ç–∏).

–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏: **Backend ‚Äî Django/DRF**, **Frontend ‚Äî React + TypeScript (Vite), FullCalendar**.  
–ü—Ä–æ—Ü–µ—Å—Å: GitHub flow (–≤–µ—Ç–∫–∞ ‚Üí PR ‚Üí —Ä–µ–≤—å—é ‚Üí merge).  

---
## üîß –°—Å—ã–ª–∫–∏
api.dev.cedar.school - –±–µ–∫ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
dev.cedar.school - –∞–¥—Ä–µ—Å –¥–ª—è —Ñ–æ–Ω—Ç–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏, –µ—Å–ª–∏ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è

api.beta.cedar.school - –±–µ–∫ –¥–ª—è –±–µ—Ç–∞–≤–µ—Ä—Å–∏–∏
beta.cedar.school - –∞–¥—Ä–µ—Å –¥–ª—è —Ñ–æ–Ω—Ç–∞ –±–µ—Ç–∞–≤–µ—Ä—Å–∏–∏

api.cedar.school - –±–µ–∫ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
cedar.school - –∞–¥—Ä–µ—Å –¥–ª—è —Ñ–æ–Ω—Ç–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

---
## üîß –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- **Backend**  
  - –ú–æ–¥—É–ª–∏: `template/`, `draft/`, `real_schedule/`, `ktp/`, `core/`.  
  - API:
    - `/api/template/` ‚Äî —Ä–∞–±–æ—Ç–∞ —Å —à–∞–±–ª–æ–Ω–Ω–æ–π –Ω–µ–¥–µ–ª–µ–π  
    - `/api/draft/` ‚Äî —á–µ—Ä–Ω–æ–≤–∏–∫–∏ –Ω–µ–¥–µ–ª–∏  
    - `/api/real-schedule/` ‚Äî —Ä–µ–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ  
    - `/api/lessons/{id}/` ‚Äî –∫–∞—Ä—Ç–æ—á–∫–∞ —É—Ä–æ–∫–∞  
    - `/api/rooms/` ‚Äî –≤–µ–±–∏–Ω–∞—Ä–Ω—ã–µ –∫–æ–º–Ω–∞—Ç—ã  
    - `/api/auth/` ‚Äî —Ä–æ–ª–∏, –¥–æ—Å—Ç—É–ø—ã  

- **Frontend**  
  - `WeekViewSwitcher` ‚Äî –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤ (–ø–æ –∫–ª–∞—Å—Å–∞–º, –ø–æ —É—á–∏—Ç–µ–ª—è–º, –Ω–æ—Ä–º—ã)  
  - `FullCalendarTemplateView` ‚Äî —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å (drag-n-drop)  
  - `TemplateWeekEditor` ‚Äî —Ä–µ–¥–∞–∫—Ç–æ—Ä —à–∞–±–ª–æ–Ω–Ω–æ–π –Ω–µ–¥–µ–ª–∏  
  - `KtpEditor` ‚Äî –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω–æ-—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ  
  - `SchedulePage` ‚Äî –ø—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è  
  - `LessonPage` ‚Äî –∫–∞—Ä—Ç–æ—á–∫–∞ —É—Ä–æ–∫–∞  

---

## üë• –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **STUDENT / PARENT** ‚Äî –≤–∏–¥—è—Ç —Å–≤–æ—ë —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, —Ç–µ–º—ã —É—Ä–æ–∫–æ–≤, –¥–æ—Å—Ç—É–ø –∫ –≤–µ–±–∏–Ω–∞—Ä—É.  
- **TEACHER** ‚Äî —Å–≤–æ—ë —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, —Ç–µ–º—ã –∏ –¥–æ–º–∞—à–∫–∏.  
- **HEAD_TEACHER / DIRECTOR** ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–Ω—ã–º–∏ –Ω–µ–¥–µ–ª—è–º–∏, –¥–æ—Å—Ç—É–ø –∫ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é –∫–ª–∞—Å—Å–æ–≤/—É—á–∏—Ç–µ–ª–µ–π.  
- **ADMIN** ‚Äî –≤—ã–¥–∞—á–∞ —Ä–æ–ª–µ–π –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞–º–∏.  

---

## üìÖ –ü–ª–∞–Ω —Å–ø—Ä–∏–Ω—Ç–∞ (25‚Äì31 –∞–≤–≥—É—Å—Ç–∞)

### 1) RealLesson pipeline (Backend)
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è `RealLesson` –∏–∑ –∞–∫—Ç–∏–≤–Ω–æ–π –Ω–µ–¥–µ–ª–∏ + –ö–¢–ü  
- `commit_draft`: –º–∞–ø–ø–∏–Ω–≥ `type ‚Üí LessonType`  
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ç–µ–º –ö–¢–ü –≤ `RealLesson`  

### 2) `/schedule` ‚Äî –ú–æ—ë —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ (MVP)
**Backend**
- `GET /api/real-schedule/my/?from=&to=` (—Ä–æ–ª—å-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ, student/parent/teacher)  
- –ü—Ä–∞–≤–∏–ª–∞ –¥–æ—Å—Ç—É–ø–∞: —á—É–∂–∏–µ –¥–∞–Ω–Ω—ã–µ ‚Üí 403  
**Frontend**
- –†–æ—É—Ç `/schedule`, FullCalendar (–±–µ–∑ dnd), —Ö—É–∫ `useMyRealSchedule`  
- –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ ¬´–ù–µ—Ç —É—Ä–æ–∫–æ–≤¬ª, –∫–ª–∏–∫ –ø–æ —Å–æ–±—ã—Ç–∏—é ‚Üí `/lesson/:id`  
- 403 ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/forbidden`  

### 3) –†–æ–ª–∏ –∏ –¥–æ—Å—Ç—É–ø—ã
**Backend**
- –í—ã–¥–∞—á–∞/—Å–º–µ–Ω–∞ —Ä–æ–ª–µ–π –∞–¥–º–∏–Ω–æ–º  
- –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ 403 –Ω–∞ –∑–∞—â–∏—â—ë–Ω–Ω—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞—Ö  
**Frontend**
- –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ø–µ—Ä–µ—Ö–≤–∞—Ç 403  
- –°—Ç—Ä–∞–Ω–∏—Ü–∞ `/forbidden`: ¬´–°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è —Ä–æ–ª–∏ ‚Ä¶¬ª  

### 4) –°—Ç—Ä–∞–Ω–∏—Ü–∞ —É—Ä–æ–∫–∞
**Backend**
- `GET /api/lessons/{id}/`: —Ç–µ–º–∞, —É—á–∞—Å—Ç–Ω–∏–∫–∏, –º–∞—Ç–µ—Ä–∏–∞–ª—ã, `webinar_url`, `homework_summary?`  
**Frontend**
- –†–æ—É—Ç `/lesson/:id`, –∫–∞—Ä—Ç–æ—á–∫–∞ —É—Ä–æ–∫–∞  
- –ö–Ω–æ–ø–∫–∞ ¬´–í–µ–±–∏–Ω–∞—Ä¬ª (disabled –µ—Å–ª–∏ `null`)  
- –ë–ª–æ–∫ ¬´–î–æ–º–∞—à–∫–∞¬ª (–∑–∞–≥–ª—É—à–∫–∞)  

### 5) TemplateWeekEditor ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–ª–∏–∑–∏–π (Frontend)
- –ö–Ω–æ–ø–∫–∞ ¬´–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–ª–∏–∑–∏–∏¬ª ‚Üí –≤—ã–∑–æ–≤ `/validate/`  
- –ü–∞–Ω–µ–ª—å –ø—Ä–æ–±–ª–µ–º (–æ—à–∏–±–∫–∏/–≤–∞—Ä–Ω–∏–Ω–≥–∏), –∫–ª–∏–∫ ‚Üí –ø–æ–¥—Å–≤–µ—Ç–∫–∞/—Å–∫—Ä–æ–ª–ª –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ  

### 6) –í–µ–±–∏–Ω–∞—Ä–Ω—ã–µ –∫–æ–º–Ω–∞—Ç—ã
**Backend**
- –ú–æ–¥–µ–ª—å `Room (lesson_id, join_url, provider)`  
- –≠–Ω–¥–ø–æ–∏–Ω—Ç —Å–æ–∑–¥–∞–Ω–∏—è/–ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–º–Ω–∞—Ç—ã  
**Frontend**
- –ö–Ω–æ–ø–∫–∞ ¬´–í–µ–±–∏–Ω–∞—Ä¬ª –Ω–∞ `/lesson/:id` –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç `join_url`  

### 7) –§–∏–ª—å—Ç—Ä—ã/–ø–æ–∏—Å–∫ –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä—è—Ö
**Backend**
- `GET /api/real-schedule/?teacher_id=&grade_id=&subject_id=&from=&to=`  
- `GET /api/template/teachers/?q=` ‚Äî –ø–æ–∏—Å–∫ –ø–æ –§–ò–û  
**Frontend**
- –ü–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤ (Teacher/Grade/Subject), –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫ FullCalendar  

### 8) –¢–µ—Å—Ç—ã
**Backend**
- –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã: `_collect_overlap_ids`, `check_collisions`  
**Frontend**
- e2e happy-path: ¬´/schedule ‚Üí –∫–ª–∏–∫ ‚Üí /lesson/:id¬ª  
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω—ã–µ —Ç–µ—Å—Ç—ã –ø–∞–Ω–µ–ª–∏ –ø—Ä–æ–±–ª–µ–º  

---

## ‚úÖ Definition of Done –¥–ª—è —Å–ø—Ä–∏–Ω—Ç–∞
- `/schedule` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç ¬´–º–æ—ë —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ¬ª –¥–ª—è student/parent/teacher.  
- –°—Ç—Ä–∞–Ω–∏—Ü–∞ —É—Ä–æ–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∏–∑ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è.  
- –í TemplateWeekEditor –º–æ–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–ª–∏–∑–∏–∏.  
- 403 –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∏ –≤–µ–¥—ë—Ç –Ω–∞ `/forbidden`.  
- –í–µ–±–∏–Ω–∞—Ä–Ω—ã–µ –∫–æ–º–Ω–∞—Ç—ã –ø–æ–¥–∫–ª—é—á–µ–Ω—ã (–∫–Ω–æ–ø–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç).  
- –§–∏–ª—å—Ç—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏ (–º–∏–Ω–∏–º–∞–ª—å–Ω–æ teacher/grade).  
- –ë—ç–∫–µ–Ω–¥ –∏ —Ñ—Ä–æ–Ω—Ç –ø–æ–∫—Ä—ã—Ç—ã –±–∞–∑–æ–≤—ã–º–∏ —Ç–µ—Å—Ç–∞–º–∏.  
