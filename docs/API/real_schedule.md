# Cedar.school API ‚Äî Real Schedule

–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è: ¬´–º–æ—ë —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ¬ª, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è, –ø—Ä–æ–≤–µ–¥–µ–Ω–∏–µ —É—Ä–æ–∫–∞, –∫–æ–º–Ω–∞—Ç—ã –≤–∏–¥–µ–æ–∑–∞–Ω—è—Ç–∏–π.

---

## üë§ My schedule

### GET /api/real_schedule/my/?from=&to=
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ **–¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** –∑–∞ –ø–µ—Ä–∏–æ–¥. 
–ï—Å–ª–∏ from/to –Ω–µ —É–∫–∞–∑–∞–Ω—ã ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–µ–¥–µ–ª—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. 
–†–æ–ª–µ–≤–∞—è –ª–æ–≥–∏–∫–∞: –∞–¥–º–∏–Ω-—Ä–æ–ª–∏–∏ –≤–∏–¥—è—Ç –≤—Å—ë; —É—á–∏—Ç–µ–ª—å ‚Äî —Å–≤–æ–∏ –∑–∞–Ω—è—Ç–∏—è; —É—á–µ–Ω–∏–∫ ‚Äî –ø–æ –∫–ª–∞—Å—Å—É/–∏–Ω–¥–∏–≤–∏–¥—É–∞–ª–∫–∞–º; —Ä–æ–¥–∏—Ç–µ–ª—å ‚Äî –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ –ø–æ –¥–µ—Ç—è–º (–æ–ø—Ü. `children=1,2`)„Äê103‚Ä†source„Äë.

**–û—Ç–≤–µ—Ç:**
```json
{ "from": "YYYY-MM-DD", "to": "YYYY-MM-DD", "count": N, "results": [ ... ] }
```

---

## ‚öôÔ∏è Generate

### POST /api/real_schedule/generate/
–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –∑–∞–Ω—è—Ç–∏—è –∑–∞ –ø–µ—Ä–∏–æ–¥. 
–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –≤ —Ç–µ–ª–µ –∏–ª–∏ –∫–∞–∫ query:
- `from` (YYYY-MM-DD), `to` (YYYY-MM-DD) ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ, –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª.
- `template_week_id` ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —à–∞–±–ª–æ–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é (–∏–Ω–∞—á–µ –≤—ã–±–æ—Ä –≤–Ω—É—Ç—Ä–∏ —Å–µ—Ä–≤–∏—Å–∞).
- `rewrite_from` ‚Äî –¥–∞—Ç–∞, —Å –∫–æ—Ç–æ—Ä–æ–π –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ —É—Ä–æ–∫–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é = `from`).
- `debug` ‚Äî bool.
 
**–£—Å–ø–µ—Ö (201)**
```json
{
  "version": "vX",
  "generation_batch_id": "...",
  "deleted": 10,
  "created": 120,
  "created_with_ktp": 100,
  "created_without_ktp": 20,
  "warnings_count": 20,
  "warnings_summary": {"2/3": 5},
  "warnings": [ {"message": "–ù–µ—Ç KTPEntry –¥–ª—è 2025-09-01 2/3"} ]
}
```
**–û—à–∏–±–∫–∏:** 400 `INVALID_RANGE` / `COLLISIONS`, 500 `INTERNAL_ERROR`.  
**–†–æ–ª–∏:** –ø–æ –∫–æ–¥—É ‚Äî –∞–¥–º–∏–Ω—Å–∫–∏–µ (IsAdminUser –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ö)„Äê102‚Ä†source„Äë.

---

## ‚úÖ Conduct Lesson

### POST /api/real_schedule/lessons/<id>/conduct/
–ü–æ–º–µ—á–∞–µ—Ç —É—Ä–æ–∫ –∫–∞–∫ –ø—Ä–æ–≤–µ–¥—ë–Ω–Ω—ã–π; –µ—Å–ª–∏ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –ö–¢–ü, –≤—ã—Å—Ç–∞–≤–ª—è–µ—Ç `actual_date` (–µ—Å–ª–∏ –Ω–µ –±—ã–ª–æ).  
Body –æ–ø—Ü.: `{ "conducted_at": "2025-09-05T10:00:00Z" }`.  
**–†–æ–ª–∏:** IsAdminUser (–ø–æ –∫–æ–¥—É)„Äê102‚Ä†source„Äë.

---

## üü£ Rooms

### POST /api/real_schedule/rooms/get-or-create/
–°–æ–∑–¥–∞—Ç—å/–≤–µ—Ä–Ω—É—Ç—å –∫–æ–º–Ω–∞—Ç—É –≤–∏–¥–µ–æ–∑–∞–Ω—è—Ç–∏—è. –¢–µ–ª–æ: `{ "lesson_id": <int>, "provider": "JITSI", "join_url": "<url>" }`.  
–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã `lesson_id` –∏ `join_url`. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç Room.  
**–†–æ–ª–∏:** IsAdminUser„Äê102‚Ä†source„Äë.

### POST /api/real_schedule/rooms/<id>/end/
–ó–∞–≤–µ—Ä—à–∏—Ç—å –∫–æ–º–Ω–∞—Ç—É (`ended_at = now`), –≤–µ—Ä–Ω—É—Ç—å Room.  
**–†–æ–ª–∏:** IsAdminUser„Äê102‚Ä†source„Äë.

---

## üß≠ –†–æ—É—Ç–∏–Ω–≥
–ü—Ä–µ—Ñ–∏–∫—Å –º–æ–¥—É–ª—è: `/api/real_schedule/`  
–ü—É—Ç–∏: `my/`, `generate/`, `lessons/<id>/conduct/`, `rooms/get-or-create/`, `rooms/<id>/end/`„Äê101‚Ä†source„Äë.

---

## üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Å `Authorization: Bearer {{access_token}}`.
